---
layout: center
transition: slide-up
---

<h1 class="!text-6xl">Les routes</h1>

<SlideFooter/>


---
layout: default
transition: slide-up
---
<h1>Les routes avec SvelteKit</h1>

<h2 class="!text-[18px] text-light">De quoi parles-t-on ?</h2>

<p v-click>Les routes dÃ©signent les chemins par lesquels on accÃ¨de Ã  tel ou tel Ã©cran de votre application ou page de votre site web.</p>

<p v-click>Imaginons que notre site contiennent une page de contact, et que nous voulions y acceder via l'URL <kbd>/contact</kbd>. Dans ce cas, il suffit de crÃ©er un sous-dossier <b>/contact</b> dans le dossier <b>/src/routes</b> et d'y ajouter un fichier <b>+page.svelte</b>.</p>

<div v-after class="flex">
  <Alert type="warning" title="Important !" text="Le prÃ©fixe <kbd>+</kbd> est important, il indique Ã  <b>SvelteKit</b> que ce fichier et liÃ© au routage."/>
</div>

<p v-click>Chaque sous dossier du dossier <b>/src/route</b> corresponds Ã  une URL. <br>Ainsi le fichier <b>/src/route/contact/newletter/+page.svelte</b> sera accessible via l'URL <kbd>/contact/newletter</kbd>.</p>

<p v-click>Le fichier <b>+page.svelte</b> Ã  la racine du dossier <b>/src/routes</b> corresponds Ã  la page d'accueil de votre projet.</p>



<SlideFooter/>


---
layout: default
transition: slide-up
---
<h1>Les routes dynamiques</h1>

<p class="!text-balance">
  Il est possible de gÃ©rer des routes dynamiques, c'est Ã  dire, qui contiennent un "slug".
</p>
<p class="!text-balance">
  Imaginons que vous conceviez un site sur le cinÃ©ma. Vous souhaitez crÃ©er des pages pour des films, vous pourriez tout Ã  fait crÃ©er un dossier et un fichier <b>+page.svelte</b> par film mais cela serait un peu compliquÃ© Ã  gÃ©rer.
</p>


<div v-click class="mbs-5 flex gap-10 items-center">

```html {*}{lines:false}
â””â”€â”€â”€ ğŸ“ src
      â””â”€â”€â”€ ğŸ“ routes
            â””â”€â”€â”€ ğŸ“ films
                  â””â”€â”€â”€ ğŸ“ titanic
                        â””â”€â”€â”€ ğŸ“ƒ +page.svelte
                  â””â”€â”€â”€ ğŸ“ avatar
                        â””â”€â”€â”€ ğŸ“ƒ +page.svelte
                  â””â”€â”€â”€ ğŸ“ alien
                        â””â”€â”€â”€ ğŸ“ƒ +page.svelte
                  â””â”€â”€â”€ ğŸ“ toy-story
                        â””â”€â”€â”€ ğŸ“ƒ +page.svelte
                  ...                    
```

<div v-click>
  <p>Chaque page de film est bien accessible par une URL propre, par exemple <kbd>/films/avatar</kbd>.</p>
  <Alert type="warning" title="Oui mais c'est pas top ! ğŸ˜•" text="Cette solution est trop compliquÃ©e Ã  maintenir, trop lourde Ã  gÃ©rer, trop de code dupliquÃ©, etc."/>
</div>
</div> 

<SlideFooter/>


---
layout: default
transition: slide-up
---
<h1>Les routes dynamiques</h1>

<p>Dans ce cas prÃ©cis, nous allons utiliser une route dynamique. Pour ce faire, le dossier doit Ãªtre entre crochets : </p>



<div class="mbs-5 flex gap-5 items-center">

```html {*}{lines:false}
â””â”€â”€â”€ ğŸ“ src
      â””â”€â”€â”€ ğŸ“ routes
            â””â”€â”€â”€ ğŸ“ films
                  â””â”€â”€â”€ ğŸ“ [title]
                        â””â”€â”€â”€ ğŸ“ƒ +page.svelte
```

<div v-click>
  <p>Maintenant, tous les chemins derriÃ¨re l'URL <kbd>/films/XXXX</kbd> feront rÃ©fÃ©rence au bon template.</p>
  <Alert type="idea" title="Beaucoup mieux ! ğŸ˜" text="Cette solution est plus simple Ã  maintenir, un seul fichier Ã  maintenir."/>
</div>
</div> 

<div v-click>
  <p>Toutes ces routes fairont appel au mÃªme fichier <b>+page.svelte</b>:</p>

  <ul class="mis-10">
    <li><kbd>/films/titanic</kbd></li>
    <li><kbd>/films/avatar</kbd></li>
    <li><kbd>/films/alien</kbd></li>
    <li><kbd>/films/toy-story</kbd></li>
    <li><kbd>/films/...</kbd></li>
  </ul>
</div>

<SlideFooter/>


---
layout: default
transition: slide-up
---
<h1>Les contrÃ´leurs</h1>

<p class="!text-balance">Chaque route peut avoir un contrÃ´leur spÃ©cifique pour gÃ©rer la donnÃ©e Ã  afficher. Si on reprends notre exemple de tout Ã  l'heure, lorsque je visite l'URL <kbd>/films/avatar</kbd> je souhaite afficher les donnÃ©es du film <b>Avatar</b>.</p>
<p class="!text-balance">Pour cela il faudra faire un appel Ã  une base de donnÃ©e ou une API. C'est le rÃ´le du contrÃ´leur.</p>

<p v-click>Les contrÃ´leurs doivent Ãªtre nommÃ©s <b>+page.js</b> (ou <b>+page.ts</b> si vous utilisez typescript), et Ãªtre dans le dossier de la route associÃ©e :</p>

<div v-after class="mbs-5 gap-5 items-center">

```html {*}{lines:false}
â””â”€â”€â”€ ğŸ“ src
      â””â”€â”€â”€ ğŸ“ routes
            â””â”€â”€â”€ ğŸ“ films
                  â””â”€â”€â”€ ğŸ“ [title]
                        â””â”€â”€â”€ ğŸ“ƒ +page.svelte
                        â””â”€â”€â”€ ğŸ“ƒ +page.js
```
</div>

<SlideFooter/>


---
layout: default
transition: slide-up
---
<h1>Les contrÃ´leurs</h1>


<p>Voici un exemple de contrÃ´leur :</p>

<div v-click class="flex mbs-5">
```js
/** /src/films/+page.js */
export async function load(route) {
  const data = await fetch(`https://cinema-api.com/${route.params.title}`);
  return data;
}
```
</div>

<div v-click class="flex mbs-5 gap-5 items-center">
```svelte
<!-- /src/films/+page.svelte -->
<script>
  export let data = undefined;
</script>

<h1>{data.title}</h1>
<p>{data.content}</p>
```

<div>
  <p>Le contrÃ´leur va instancier le composant <b>+page.svelte</b> avec la propriÃ©tÃ© <b>data</b> qui contiendra la rÃ©ponse de l'API.</p>

  <Alert type="warning" title="Attention !" text="Notez que le le script est asynchrone, ce qui va provoquer un dÃ©lai dans l'affichage de la page."/>
</div>
</div>


<SlideFooter/>


---
layout: default
transition: slide-up
---
<h1>Les contrÃ´leurs</h1>

<p>On Ã  parfois besoin de passer des paramÃ¨tre dans les URL. Imaginons maintenant que l'on veuille crÃ©er une page qui liste les films par annÃ©e de sortie et par avis.</p>

<p v-click>On pourrait avoir une URL qui resemblerai Ã  Ã§a : <kbd>/films/list?year=2024&rating=5</kbd>. Dans le contrÃ´leur on peut rÃ©cupÃ©rer les valeurs de <b>year</b> et <b>rating</b> avec <b>url.searchParams</b></p>

<div v-click class="flex mbs-5">
```js
/** /src/films/list/+page.js */
export async function load(route) {
  const data = await fetch(`https://cinema-api.com/list`, {
    method: "GET",
    body: JSON.stringify({ 
      year: route.url.searchParams.get('year');
      rating: route.url.searchParams.get('rating');
    }),
  });

  return data;
}
```
</div>

<SlideFooter/>


---
layout: default
transition: slide-up
---
<h1>Les layouts</h1>


<p class="!m-2">Jusqu'Ã  prÃ©sent, nous avons traitÃ© les pages comme des composants entiÃ¨rement indÃ©pendants. Lors d'une navigation, le composant existant <b>+page.svelte</b> sera dÃ©truit, et un nouveau le remplacera.</p>

<p class="!m-2">Cependant, certains Ã©lÃ©ments doivent Ãªtre visibles sur chaque page, comme une navigation principale ou un pied de page. Au lieu de les rÃ©pÃ©ter dans chaque +page.svelte, et nous ne voulons pas qu'il soient dÃ©truit Ã  chaque changement de page. Pour se faire on va utiliser les <b>layouts</b>.</p>

<p v-click class="!m-2">
  les layouts s'Ã©crivent <b>+layout.svelte</b> et se placent dans un sous dossier de <b>/src/routes</b>. Toutes les pages qui sont contenues dans ce dossier ou dans un de ses sous-dossiers hÃ©riter de ce layout.
</p>
  

<div v-after class="mbs-2">

```html {*}{lines:false}
â””â”€â”€â”€ ğŸ“ routes
      â””â”€â”€â”€ ğŸ“ƒ +layout.svelte <!-- Layout commun Ã  toutes les routes -->
      â””â”€â”€â”€ ğŸ“ films
            â””â”€â”€â”€ ğŸ“ [title]
            â”‚     â””â”€â”€â”€ ğŸ“ƒ +page.svelte
            â”‚     â””â”€â”€â”€ ğŸ“ƒ +page.js
            â””â”€â”€â”€ ğŸ“ list
            â””â”€â”€â”€ ğŸ“ƒ +layout.svelte <!-- Layout spÃ©cifique Ã  la route /film/list -->
            â””â”€â”€â”€ ğŸ“ƒ +page.svelte
            â””â”€â”€â”€ ğŸ“ƒ +page.js
```
</div>

<SlideFooter/>


---
layout: default
transition: slide-up
---
<h1>Les layouts</h1>

<p>Pour l'exemple, nous allons crÃ©er un composant <kbd>Header</kbd> qui sera ajoutÃ© au layout global.</p>


<div v-click class="flex mbs-2">

```html {*}{lines:false}
â””â”€â”€â”€ ğŸ“ components
      â””â”€â”€â”€ ğŸ“ Header
            â””â”€â”€â”€ ğŸ“ƒ Header.svelte
            â””â”€â”€â”€ ğŸ“ƒ Header.css
```
</div>


<div v-click class="flex gap-5 -mbs-3">

<div>
<p class="!mbe-0"><b>Header.svelte :</b></p>

```svelte
<script>
  export let title = undefined;
</script>

<header>
  <h1>{title}</h1>
</header>

<style>
  @import './Header.css';
</style>
```
</div>  

<div>
<p class="!mbe-0"><b>Header.css :</b></p>

```css
header {
  padding: 10px;
  background-color: #eeeeee;
  border-block-end: 1px solid #333333;
  margin-block-end: 20px;
}

header h1 {
  margin: 0;
}
```
</div>  
</div>  

<SlideFooter/>


---
layout: default
transition: slide-up
---
<h1>Les layouts</h1>

<p>DorÃ©navant, il suffit de crÃ©er un fichier <b>+layout.svelte</b> Ã  la racine du dossier <b>/src/route</b> pour y ajouter le header :</p>

<div v-click class="mbs-2">

<p class="!mbe-0"><b>+layout.js :</b></p>
```js
export function load(route) {
  return { title: route?.params?.slug };
}
```

<p class="!mbe-0"><b>+layout.svelte :</b></p>
```svelte
<script>
  import Header from "../components/Header/Header.svelte";
  export let data = undefined

  const title = data?.title;
</script>

<Header {title}/>

<slot />
```
</div>

<SlideFooter/>


---
layout: default
transition: slide-up
---
<h1>Gestion des erreurs</h1>

<p><b>SvelteKit</b> propose une solution trÃ¨s simple pour la gestion des pages d'erreur. Il suffit d'ajouter un fichier <b>+error.svelte</b> dans le dossier <b>/src/routes</b>.</p>

<p>Il est possible de crÃ©er une page <b>+error.svelte</b> diffÃ©rentes pour chaque sous-dossier du dossier <b>/src/routes</b>, et les pages d'erreur hÃ©ritent elles aussi des layouts.</p>


<div v-click class="flex mbs-5 gap-5 items-center">
<div>
<p><b>src/routes/+error.svelte</b></p>

```svelte
<script>
	import { page } from '$app/state';
</script>

<h1>{page.error.message}</h1>

<p>Une erreur s'est produite.</p>

<a href="/">Retour Ã  l'accueil</a>
```
</div>


<Alert v-after type="idea" title="Information" text="**$app/state** est un **store** qui contient des informations sur l'Ã©tat de page courante." />
</div>

<SlideFooter/>